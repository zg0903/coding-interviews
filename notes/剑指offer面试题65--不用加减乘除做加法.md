# 剑指offer面试题65--不用加减乘除做加法

```text
写一个函数，求两个整数之和，要求在函数体内不得使用"+"、"-"、"x"、"÷"四则运算符号。
```

不能用四则运算，自然容易想到用位运算。但如何使用位运算作加法呢？先来分析十进制是如何作加法的。比如要`18 + 6`

```text
  1 8
+ 0 6
——————
  1 4
+ 1 0
——————
  2 4

1) 个位和个位相加，十位与十位相加，但不进位；
2) 6 + 8产生一位进位得到10，1 + 0不产生进位；
3) 不进位的和14 + 个位的进位10 = 24。

没有进位了，计算停止。

```

可以看到十进制作加法可以细分为以上三步。那么对于二进制的加法呢？18的二进制是10010，6的二进制是110

```text
  10010
+ 00110
————————
  10100
+ 00100   （还有进位，继续计算）
————————
  10000
+ 01000   （没有进位，停止计算）
————————
  10100
```

10100正好是24的十进制表示。换成二进制作加法，原理一样。关键是：**如果还有进位，要不断累加，直到没有进位，此时计算才停止。**

对于二进制，**不进位的的加法就是异或运算，计算进位只需将两个数相与并向左移一位（也就是进位）。**

接下来写代码就不难了。

```java
package Chap6;

public class Add {
    public int add(int num1, int num2) {
        // num2 != 0 说明还有进位需要相加
        while (num2 != 0) {
            int sum = num1 ^ num2;
            int carry = (num1 & num2) << 1;
            num1 = sum;
            num2 = carry;
        }
        return num1;
    }
}

```

上面代码中sum表示不进位的加法和，carry表示进位，每次迭代都将sum和carry进行不进位相加，num2等于0（即不再有进位）时，退出循环返回num1即可。

## 扩展--不引用新变量交换两个变量

一般写个swap方法，需要引入第三个变量。如下

```java
public int swap(int a, int b) {
    int temp = a;
    a = b;
    b = temp;
}
```

如果要交换的数据类型是int型的数字，如何不使用新的变量，交换两个变量的值？使用如下的运算即可完成。

```java
a = a + b;
b = a - b;
a  = a - b;

或者

a = a ^ b;
b = a ^ b;
a = a ^ b;
```

在纸上推导下就能验证上面式子的正确性。

---

by @sunhaiyu

2018.2.13
